<div class="theme-toggle">
    <a href="#" id="theme-toggle-btn" class="nav-link" aria-label="Toggle Theme">
        <i class="fas fa-sun" aria-hidden="true"></i>
        <span class="sr-only">Toggle Theme</span>
    </a>
</div>

<style>
    .theme-toggle {
        display: inline-block;
        margin-left: 10px;
    }

    #theme-toggle-btn {
        cursor: pointer;
        display: inline-block;
        color: inherit;
        /* Ensure icon size matches text */
        font-size: 1.1em;
    }

    #theme-toggle-btn:hover {
        opacity: 0.8;
    }
</style>

<script>
    (function () {
        const btn = document.getElementById('theme-toggle-btn');
        const icon = btn.querySelector('i');

        // Define themes and their corresponding icons
        // Order: Light -> Dark -> Retro -> Light
        const themes = [
            { name: 'light', icon: 'fa-sun' },
            { name: 'dark', icon: 'fa-moon' },
            { name: 'retro-terminal', icon: 'fa-code' }
        ];

        if (!btn) return;

        // Initialize state
        const currentThemeName = localStorage.getItem('theme') ||
            (document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light');

        updateIcon(currentThemeName);

        btn.addEventListener('click', function (e) {
            e.preventDefault();

            // Get current status
            const currentAttr = document.documentElement.getAttribute('data-theme');
            // If attribute is missing, it's default (light usually, or system pref). 
            // We need to resolve what "current" really is to find next.
            let activeThemeName = currentAttr || 'light';

            // Find index
            let currentIndex = themes.findIndex(t => t.name === activeThemeName);
            if (currentIndex === -1) currentIndex = 0; // Fallback to light

            // Calculate next index
            const nextIndex = (currentIndex + 1) % themes.length;
            const nextTheme = themes[nextIndex];

            setTheme(nextTheme.name);
            updateIcon(nextTheme.name);
        });

        function setTheme(theme) {
            if (theme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }
        }

        function updateIcon(themeName) {
            // Find theme object or default to light
            const themeObj = themes.find(t => t.name === themeName) || themes[0];

            // Remove all known icons
            themes.forEach(t => icon.classList.remove(t.icon));

            // Add new icon
            icon.classList.add(themeObj.icon);
        }
    })();
</script>